<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursa d'accents</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            overflow: hidden;
        }
        #barra-temps-progres {
            transition: width 0.1s linear;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake-error {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes flash-correct {
            0% { background-color: #ecfdf5; }
            50% { background-color: #d1fae5; }
            100% { background-color: #ecfdf5; }
        }
        .flash-correct {
            animation: flash-correct 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Joc -->
    <div id="game-container" class="bg-white rounded-xl shadow-2xl p-6 md:p-10 w-full max-w-md relative">
        
        <!-- Marcador -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <span class="text-lg font-semibold text-gray-600">Puntuació</span>
                <span id="puntuacio" class="text-2xl font-bold text-blue-700 ml-2">0</span>
            </div>
            <div id="vides-container" class="flex gap-2">
                <!-- Cors -->
            </div>
        </div>

        <!-- Paraula -->
        <div id="paraula-container" class="bg-blue-50 text-blue-800 text-5xl font-bold p-6 rounded-lg mb-6 text-center tracking-wider">
            <!-- La paraula apareixerà aquí -->
        </div>

        <!-- Barra de temps -->
        <div class="w-full bg-gray-200 rounded-full h-4 mb-6 overflow-hidden">
            <div id="barra-temps-progres" class="bg-green-500 h-4 rounded-full" style="width: 100%;"></div>
        </div>

        <!-- Botons -->
        <div class="grid grid-cols-3 gap-3">
            <button id="aguda-btn" class="game-btn bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                Aguda
            </button>
            <button id="plana-btn" class="game-btn bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                Plana
            </button>
            <button id="esdrúixola-btn" class="game-btn bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
    Esdrúixola
</button>

        </div>

        <p class="mt-4 text-xs text-gray-400 text-center">
            Versió 2.0 – si veus això, tens el codi nou.
        </p>
    </div>

    <!-- Modal Game Over -->
    <div id="game-over-modal" class="absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-8 md:p-12 w-full max-w-md text-center">
            <h2 id="game-over-title" class="text-4xl font-bold text-red-600 mb-4">S'ha acabat!</h2>
            <p class="text-xl text-gray-700 mb-6">La teva puntuació final és:</p>
            <span id="puntuacio-final" class="text-7xl font-bold text-blue-700 mb-8 block">0</span>
            <button id="restart-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 text-lg">
                Tornar a començar
            </button>
        </div>
    </div>

    <script>
        // BANC DE PARAULES
        var BANC_DE_PARAULES = [
            // Planes
          { paraula: "poma", tipus: "plana", tonica: "po" },
{ paraula: "casa", tipus: "plana", tonica: "ca" },
{ paraula: "terra", tipus: "plana", tonica: "ter" },
{ paraula: "porta", tipus: "plana", tonica: "por" },
{ paraula: "finestra", tipus: "plana", tonica: "nes" },
{ paraula: "carpeta", tipus: "plana", tonica: "pe" },
{ paraula: "cendra", tipus: "plana", tonica: "cen" },
{ paraula: "manta", tipus: "plana", tonica: "man" },
{ paraula: "vinagre", tipus: "plana", tonica: "na" },
{ paraula: "plàtan", tipus: "plana", tonica: "plà" },
{ paraula: "càstig", tipus: "plana", tonica: "càs" },
{ paraula: "dòlar", tipus: "plana", tonica: "dò" },
{ paraula: "còmic", tipus: "plana", tonica: "cò" },
{ paraula: "trànsit", tipus: "plana", tonica: "tràn" },
{ paraula: "marge", tipus: "plana", tonica: "mar" },
{ paraula: "rètol", tipus: "plana", tonica: "rè" },
{ paraula: "poble", tipus: "plana", tonica: "po" },
{ paraula: "bossa", tipus: "plana", tonica: "bos" },
{ paraula: "fusta", tipus: "plana", tonica: "fus" },
{ paraula: "norma", tipus: "plana", tonica: "nor" },
{ paraula: "timbre", tipus: "plana", tonica: "tim" },
{ paraula: "càrrec", tipus: "plana", tonica: "càr" },
{ paraula: "llista", tipus: "plana", tonica: "llis" },
{ paraula: "regle", tipus: "plana", tonica: "re" },
{ paraula: "finesa", tipus: "plana", tonica: "ne" },
{ paraula: "flama", tipus: "plana", tonica: "fla" },
{ paraula: "llapis", tipus: "plana", tonica: "lla" },
{ paraula: "lluna", tipus: "plana", tonica: "llu" },
{ paraula: "tàndem", tipus: "plana", tonica: "tàn" },
{ paraula: "tòtem", tipus: "plana", tonica: "tò" },
{ paraula: "símbol", tipus: "plana", tonica: "sím" },
{ paraula: "túnel", tipus: "plana", tonica: "tú" },
{ paraula: "llimona", tipus: "plana", tonica: "mo" },
{ paraula: "pega", tipus: "plana", tonica: "pe" },
{ paraula: "àcid", tipus: "plana", tonica: "à" }

            // Agudes
           { paraula: "matalàs", tipus: "aguda", tonica: "làs" },
{ paraula: "cafè", tipus: "aguda", tonica: "fè" },
{ paraula: "control", tipus: "aguda", tonica: "trol" },
{ paraula: "canal", tipus: "aguda", tonica: "nal" },
{ paraula: "institut", tipus: "aguda", tonica: "tut" },
{ paraula: "concert", tipus: "aguda", tonica: "cert" },
{ paraula: "mercat", tipus: "aguda", tonica: "cat" },
{ paraula: "gener", tipus: "aguda", tonica: "ner" },
{ paraula: "ciment", tipus: "aguda", tonica: "ment" },
{ paraula: "pilot", tipus: "aguda", tonica: "lot" },
{ paraula: "cervell", tipus: "aguda", tonica: "vell" },
{ paraula: "cabàs", tipus: "aguda", tonica: "bàs" },
{ paraula: "record", tipus: "aguda", tonica: "cord" },
{ paraula: "paper", tipus: "aguda", tonica: "per" },
{ paraula: "animal", tipus: "aguda", tonica: "mal" },
{ paraula: "cartró", tipus: "aguda", tonica: "tró" },
{ paraula: "balcó", tipus: "aguda", tonica: "có" },
{ paraula: "matí", tipus: "aguda", tonica: "tí" },
{ paraula: "sofà", tipus: "aguda", tonica: "fà" },
{ paraula: "cantant", tipus: "aguda", tonica: "tant" },
{ paraula: "color", tipus: "aguda", tonica: "lor" },
{ paraula: "calor", tipus: "aguda", tonica: "lor" },
{ paraula: "motor", tipus: "aguda", tonica: "tor" },
{ paraula: "treball", tipus: "aguda", tonica: "ball" },
{ paraula: "penjar", tipus: "aguda", tonica: "jar" },
{ paraula: "cantar", tipus: "aguda", tonica: "tar" },
{ paraula: "abric", tipus: "aguda", tonica: "bric" },
{ paraula: "detall", tipus: "aguda", tonica: "tall" },
{ paraula: "presó", tipus: "aguda", tonica: "só" },
{ paraula: "comandament", tipus: "aguda", tonica: "ment" },
{ paraula: "reforç", tipus: "aguda", tonica: "forç" },
{ paraula: "retorn", tipus: "aguda", tonica: "torn" },
{ paraula: "servidor", tipus: "aguda", tonica: "dor" },
{ paraula: "cargol", tipus: "aguda", tonica: "gol" },
{ paraula: "cabell", tipus: "aguda", tonica: "bell" }

            // Esdrúixoles
          { paraula: "música", tipus: "esdrúixola", tonica: "mú" },
{ paraula: "lògica", tipus: "esdrúixola", tonica: "lò" },
{ paraula: "fàbrica", tipus: "esdrúixola", tonica: "fà" },
{ paraula: "pel·lícula", tipus: "esdrúixola", tonica: "lí" },
{ paraula: "pàgina", tipus: "esdrúixola", tonica: "pà" },
{ paraula: "càmera", tipus: "esdrúixola", tonica: "cà" },
{ paraula: "ànima", tipus: "esdrúixola", tonica: "à" },
{ paraula: "príncep", tipus: "esdrúixola", tonica: "prín" },
{ paraula: "dècima", tipus: "esdrúixola", tonica: "dè" },
{ paraula: "sàtira", tipus: "esdrúixola", tonica: "sà" },
{ paraula: "pèssima", tipus: "esdrúixola", tonica: "pès" },
{ paraula: "mètrica", tipus: "esdrúixola", tonica: "mè" },
{ paraula: "mànega", tipus: "esdrúixola", tonica: "mà" },
{ paraula: "tècnica", tipus: "esdrúixola", tonica: "tèc" },
{ paraula: "cúpula", tipus: "esdrúixola", tonica: "cú" },
{ paraula: "càpsula", tipus: "esdrúixola", tonica: "càp" },
{ paraula: "física", tipus: "esdrúixola", tonica: "fí" },
{ paraula: "plàcida", tipus: "esdrúixola", tonica: "plà" },
{ paraula: "càrrega", tipus: "esdrúixola", tonica: "càr" },
{ paraula: "rúbrica", tipus: "esdrúixola", tonica: "rú" },
{ paraula: "tràgica", tipus: "esdrúixola", tonica: "trà" },
{ paraula: "crítica", tipus: "esdrúixola", tonica: "crí" },
{ paraula: "àrnica", tipus: "esdrúixola", tonica: "àr" },
{ paraula: "crònica", tipus: "esdrúixola", tonica: "crò" },
{ paraula: "víscera", tipus: "esdrúixola", tonica: "vís" },
{ paraula: "úlcera", tipus: "esdrúixola", tonica: "úl" },
{ paraula: "túnica", tipus: "esdrúixola", tonica: "tú" },
{ paraula: "àrtica", tipus: "esdrúixola", tonica: "àr" },
{ paraula: "ètnica", tipus: "esdrúixola", tonica: "èt" },
{ paraula: "gòtica", tipus: "esdrúixola", tonica: "gò" },
{ paraula: "mèdica", tipus: "esdrúixola", tonica: "mè" },
{ paraula: "cèl·lula", tipus: "esdrúixola", tonica: "cèl" },
{ paraula: "pròfuga", tipus: "esdrúixola", tonica: "prò" }
        ];

        // Estat del joc
        var paraulesDisponibles = [];
        var paraulaActual = null;
        var puntuacio = 0;
        var vides = 3;
        var tempsRestant = 10;
        var intervalTemps = null;
        var haGuanyat = false;

        var TEMPS_INICIAL = 10;        // segons
        var VIDES_INICIALS = 3;
        var PUNTUACIO_OBJECTIU = 1000;

        // DOM
        var puntuacioDisplay = document.getElementById('puntuacio');
        var videsContainer = document.getElementById('vides-container');
        var paraulaContainer = document.getElementById('paraula-container');
        var barraTempsProgres = document.getElementById('barra-temps-progres');
        var gameButtons = document.querySelectorAll('.game-btn');
        var gameOverModal = document.getElementById('game-over-modal');
        var gameOverTitle = document.getElementById('game-over-title');
        var puntuacioFinalDisplay = document.getElementById('puntuacio-final');
        var restartBtn = document.getElementById('restart-btn');

        var COR_PLE = '<svg class="w-8 h-8 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>';
        var COR_BUIT = '<svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 20.5l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg>';

        // Barreja
        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var tmp = array[i];
                array[i] = array[j];
                array[j] = tmp;
            }
        }

        function actualitzarUI() {
            puntuacioDisplay.textContent = puntuacio;

            videsContainer.innerHTML = '';
            for (var i = 0; i < VIDES_INICIALS; i++) {
                if (i < vides) {
                    videsContainer.innerHTML += COR_PLE;
                } else {
                    videsContainer.innerHTML += COR_BUIT;
                }
            }
        }

        function seguentTorn() {
            paraulaContainer.className = "bg-blue-50 text-blue-800 text-5xl font-bold p-6 rounded-lg mb-6 text-center tracking-wider";

            if (paraulesDisponibles.length === 0) {
                paraulesDisponibles = BANC_DE_PARAULES.slice();
                shuffleArray(paraulesDisponibles);
            }

            paraulaActual = paraulesDisponibles.pop();
            paraulaContainer.textContent = paraulaActual.paraula;

            tempsRestant = TEMPS_INICIAL;
            barraTempsProgres.style.width = '100%';
            barraTempsProgres.className = "bg-green-500 h-4 rounded-full";

            if (intervalTemps) {
                clearInterval(intervalTemps);
            }
            intervalTemps = setInterval(actualitzarTemps, 100);

            for (var i = 0; i < gameButtons.length; i++) {
                gameButtons[i].disabled = false;
            }
        }

        function actualitzarTemps() {
            tempsRestant -= 0.1;
            var percentatge = (tempsRestant / TEMPS_INICIAL) * 100;
            if (percentatge < 0) {
                percentatge = 0;
            }
            barraTempsProgres.style.width = percentatge + '%';

            if (percentatge < 25) {
                barraTempsProgres.className = "bg-red-500 h-4 rounded-full";
            } else if (percentatge < 50) {
                barraTempsProgres.className = "bg-yellow-500 h-4 rounded-full";
            } else {
                barraTempsProgres.className = "bg-green-500 h-4 rounded-full";
            }

            if (tempsRestant <= 0) {
                clearInterval(intervalTemps);
                comprovarResposta(null);
            }
        }

        function comprovarResposta(respostaUsuari) {
            if (intervalTemps) {
                clearInterval(intervalTemps);
            }
            for (var i = 0; i < gameButtons.length; i++) {
                gameButtons[i].disabled = true;
            }

            if (tempsRestant < 0) {
                tempsRestant = 0;
            }

            var esCorrecte = (respostaUsuari === paraulaActual.tipus);

            if (esCorrecte) {
                // Criteri invers: com més temps resta, més punts
                var puntsPregunta = Math.max(1, Math.round(tempsRestant * 5));
                puntuacio += puntsPregunta;

                paraulaContainer.className += " flash-correct bg-green-50";

                setTimeout(function () {
                    actualitzarUI();
                    if (puntuacio >= PUNTUACIO_OBJECTIU) {
                        haGuanyat = true;
                        gameOver();
                    } else {
                        seguentTorn();
                    }
                }, 500);

            } else {
                vides--;
                paraulaContainer.className += " shake-error bg-red-100";

                var tipusCorrecte = paraulaActual.tipus.charAt(0).toUpperCase() + paraulaActual.tipus.slice(1);
                paraulaContainer.textContent = paraulaActual.paraula + " (" + tipusCorrecte + ")";

                setTimeout(function () {
                    actualitzarUI();
                    if (vides === 0) {
                        haGuanyat = false;
                        gameOver();
                    } else {
                        seguentTorn();
                    }
                }, 1500);
            }
        }

        function gameOver() {
            if (haGuanyat) {
                gameOverTitle.textContent = "Felicitats, has guanyat!";
            } else {
                gameOverTitle.textContent = "S'ha acabat!";
            }
            puntuacioFinalDisplay.textContent = puntuacio;
            gameOverModal.classList.remove('hidden');
        }

        function iniciarJoc() {
            puntuacio = 0;
            vides = VIDES_INICIALS;
            haGuanyat = false;

            paraulesDisponibles = BANC_DE_PARAULES.slice();
            shuffleArray(paraulesDisponibles);

            actualitzarUI();
            gameOverModal.classList.add('hidden');
            seguentTorn();
        }

        // Esdeveniments
        document.getElementById('aguda-btn').addEventListener('click', function () {
            comprovarResposta('aguda');
        });
        document.getElementById('plana-btn').addEventListener('click', function () {
            comprovarResposta('plana');
        });
        document.getElementById('esdrúixola-btn').addEventListener('click', function () {
            comprovarResposta('esdrúixola');
        });
        restartBtn.addEventListener('click', function () {
            iniciarJoc();
        });

        window.onload = function () {
            iniciarJoc();
        };
    </script>
</body>
</html>
